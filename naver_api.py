"""
============================================
ì‹¤ìŠµ 1-4: ë„¤ì´ë²„ ë‰´ìŠ¤ API í˜¸ì¶œ
============================================

ğŸ¯ ì´ ì‹¤ìŠµì˜ ëª©í‘œ:
- ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ë©´
- ë„¤ì´ë²„ì—ì„œ ê´€ë ¨ ë‰´ìŠ¤ ì œëª©ì„ ê°€ì ¸ì™€ ì¶œë ¥í•´ë³´ê¸°

ğŸ’¡ ì´ ì½”ë“œê°€ í•˜ëŠ” ì¼:
1. ì‚¬ìš©ìê°€ ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: "ì¸ê³µì§€ëŠ¥", "ë‚ ì”¨")
2. ë„¤ì´ë²„ ë‰´ìŠ¤ APIì— ê²€ìƒ‰ ìš”ì²­(GET)
3. ë‰´ìŠ¤ ì œëª© 5ê°œë¥¼ í™”ë©´ì— ì¶œë ¥

âš ï¸ ì¤€ë¹„ë¬¼:
- ë„¤ì´ë²„ ê°œë°œìì„¼í„° ê°€ì…
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡
- Client ID / Client Secret ë°œê¸‰

ì‹¤í–‰ ë°©ë²•:
python naver_api.py
============================================
"""

import requests   # ì¸í„°ë„·(API)ì— ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬


# ============================================
# ğŸ”‘ ë„¤ì´ë²„ API ì¸ì¦ ì •ë³´
# ============================================
# âš ï¸ ë°˜ë“œì‹œ ë³¸ì¸ì˜ ê°’ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤
# (ì´ ê°’ì€ ë¹„ë°€ë²ˆí˜¸ì²˜ëŸ¼ ì¤‘ìš”í•œ ì •ë³´ì˜ˆìš”!)
CLIENT_ID = "lcTNtSHKWYt54Uovj7Gt"
CLIENT_SECRET = "SLhlx0myND"


# ------------------------------------------------
# 1ï¸âƒ£ ë‰´ìŠ¤ ì œëª©ì—ì„œ HTML íƒœê·¸ ì œê±° í•¨ìˆ˜
# ------------------------------------------------
def clean_title(title):
    """
    ë„¤ì´ë²„ ë‰´ìŠ¤ APIëŠ”
    ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ ë¶€ë¶„ì„ <b>íƒœê·¸</b>ë¡œ ê°ì‹¸ì„œ ì¤ë‹ˆë‹¤.

    ì´ í•¨ìˆ˜ëŠ” ê·¸ íƒœê·¸ë¥¼ ì œê±°í•´ì„œ
    ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ ì œëª©ìœ¼ë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.
    """

    # <b> íƒœê·¸ ì œê±°
    title = title.replace("<b>", "")
    title = title.replace("</b>", "")

    return title


# ------------------------------------------------
# 2ï¸âƒ£ ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ í•¨ìˆ˜
# ------------------------------------------------
def search_news(keyword):
    """
    ë„¤ì´ë²„ ë‰´ìŠ¤ APIë¥¼ ì‚¬ìš©í•´
    ì…ë ¥í•œ í‚¤ì›Œë“œë¡œ ë‰´ìŠ¤ ê²€ìƒ‰í•˜ê¸°

    ë§¤ê°œë³€ìˆ˜:
        keyword (str): ê²€ìƒ‰í•  ë‹¨ì–´
    """

    print(f"\nğŸ” '{keyword}' ë‰´ìŠ¤ ê²€ìƒ‰ ì¤‘...")

    # ----------------------------------------
    # 1ë‹¨ê³„: API ì£¼ì†Œì™€ ì¸ì¦ ì •ë³´ ì„¤ì •
    # ----------------------------------------

    # ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ API ì£¼ì†Œ
    url = "https://openapi.naver.com/v1/search/news.json"

    # ë„¤ì´ë²„ APIëŠ” ìš”ì²­ í—¤ë”ì—
    # Client IDì™€ Secretì„ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤
    headers = {
        "X-Naver-Client-Id": CLIENT_ID,
        "X-Naver-Client-Secret": CLIENT_SECRET
    }

    # ê²€ìƒ‰ ì¡°ê±´(ì˜µì…˜)
    params = {
        "query": keyword,   # ê²€ìƒ‰ì–´
        "display": 5,       # ê²°ê³¼ ê°œìˆ˜ (5ê°œë§Œ)
        "sort": "sim"       # ì •ë ¬ ë°©ì‹
        # sim  : ì •í™•ë„ìˆœ
        # date : ìµœì‹ ìˆœ
    }

    # ----------------------------------------
    # 2ë‹¨ê³„: API í˜¸ì¶œ (GET ìš”ì²­)
    # ----------------------------------------
    response = requests.get(url, headers=headers, params=params)

    # ----------------------------------------
    # 3ë‹¨ê³„: ì‘ë‹µ ê²°ê³¼ í™•ì¸
    # ----------------------------------------
    print(f"ìƒíƒœ ì½”ë“œ: {response.status_code}")

    # ìš”ì²­ ì„±ê³µ (ì •ìƒ ì‘ë‹µ)
    if response.status_code == 200:
        # JSON ì‘ë‹µì„ íŒŒì´ì¬ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜
        data = response.json()

        # ë‰´ìŠ¤ ëª©ë¡ì€ itemsë¼ëŠ” ë¦¬ìŠ¤íŠ¸ì— ë“¤ì–´ ìˆìŒ
        items = data.get("items", [])

        if items:
            print(f"\nğŸ“° '{keyword}' ê´€ë ¨ ë‰´ìŠ¤ TOP {len(items)}")
            print("=" * 50)

            # ë‰´ìŠ¤ í•˜ë‚˜ì”© ì¶œë ¥
            for i, item in enumerate(items, 1):
                # ì œëª© ê°€ì ¸ì˜¤ê¸° + HTML íƒœê·¸ ì œê±°
                title = clean_title(item.get("title", ""))
                print(f"{i}. {title}")

            print("=" * 50)
        else:
            print("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.")

    # ì¸ì¦ ì˜¤ë¥˜ (ID / Secret ë¬¸ì œ)
    elif response.status_code == 401:
        print("âŒ ì¸ì¦ ì˜¤ë¥˜!")
        print("   Client IDì™€ Client Secretì„ í™•ì¸í•˜ì„¸ìš”.")

    # í˜¸ì¶œ í•œë„ ì´ˆê³¼
    elif response.status_code == 429:
        print("âŒ í˜¸ì¶œ í•œë„ ì´ˆê³¼!")
        print("   ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")

    # ê¸°íƒ€ ì˜¤ë¥˜
    else:
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {response.status_code}")


# ============================================
# 3ï¸âƒ£ í”„ë¡œê·¸ë¨ ì‹œì‘ ì§€ì 
# ============================================
if __name__ == "__main__":
    print("ğŸ“° ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ í”„ë¡œê·¸ë¨")
    print("=" * 50)

    # Client IDê°€ ì…ë ¥ë˜ì—ˆëŠ”ì§€ ë¨¼ì € í™•ì¸
    if CLIENT_ID == "" or CLIENT_SECRET == "":
        print("âš ï¸ ë¨¼ì € CLIENT_IDì™€ CLIENT_SECRETì„ ì„¤ì •í•˜ì„¸ìš”!")
        print("\nğŸ“ ë°œê¸‰ ë°©ë²•:")
        print("   1. https://developers.naver.com ì ‘ì†")
        print("   2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡")
        print("   3. ê²€ìƒ‰ API ì‚¬ìš© ì‹ ì²­")
        print("   4. ë°œê¸‰ë°›ì€ IDì™€ Secretì„ ì½”ë“œì— ì…ë ¥")
    else:
        print("ğŸ’¡ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!")
        print("   ì˜ˆ: ì¸ê³µì§€ëŠ¥, ë‚ ì”¨, ìŠ¤í¬ì¸ ")
        print("=" * 50)

        # ê³„ì† ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ ë°˜ë³µ
        while True:
            keyword = input("\nğŸ” ê²€ìƒ‰ì–´ ì…ë ¥ (ì¢…ë£Œ: q): ").strip()

            # ì¢…ë£Œ ì¡°ê±´
            if keyword.lower() == 'q':
                print("\nğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤!")
                break

            # ì •ìƒ ì…ë ¥ ì‹œ ê²€ìƒ‰ ì‹¤í–‰
            if keyword:
                search_news(keyword)
            else:
                print("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
